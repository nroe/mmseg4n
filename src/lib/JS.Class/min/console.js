JS.Console=new JS.Module('Console',{extend:{nameOf:function(a,b){var c=[],e,g,d,f;if(JS.isType(a,Array)){for(e=0,g=a.length;e<g;e++)c.push(this.nameOf(a[e]));return c}if(a.displayName)return a.displayName;d=[{name:null,o:b||JS.ENV}];f=0;while(typeof d==='object'&&f<this.MAX_DEPTH){f+=1;d=this.descend(d,a)}if(typeof d=='string'){d=d.replace(/\.prototype\./g,'#');a.displayName=d;if(a.__meta__)a.__meta__.displayName=d+'.__meta__'}return a.displayName},descend:function(a,b){var c=[],e=a.length,g=e,d,f,h;while(g--){f=a[g];if(JS.isType(f.o,Array))continue;h=f.name?f.name+'.':'';for(d in f.o){if(b&&f.o[d]===b)return h+d;c.push({name:h+d,o:f.o[d]})}}return c},MAX_DEPTH:4,convert:function(b,c){if(!b)return String(b);var e=JS.Enumerable,c=c||[],g;if(JS.indexOf(c,b)>=0)return'#circular';if(b instanceof Error){return(typeof b.message==='string'&&!b.message)?b.name:b.name+(b.message?': '+b.message:'')}if(b instanceof Array){c.push(b);g=new e.Collection(b).map(function(a){return this.convert(a,c)},this).join(', ');c.pop();return g?'[ '+g+' ]':'[]'}if(b instanceof String||typeof b==='string')return'"'+b+'"';if(b instanceof Function)return b.displayName||b.name||(b.toString().match(/^\s*function ([^\(]+)\(/)||[])[1]||'#function';if(b.toString&&b.toString!==Object.prototype.toString&&!b.toString.__traced__)return b.toString();c.push(b);g=new e.Collection(e.objectKeys(b,false).sort()).map(function(a){return this.convert(a,c)+': '+this.convert(b[a],c)},this).join(', ');c.pop();return g?'{ '+g+' }':'{}'},ANSI_CSI:String.fromCharCode(0x1B)+'[',MAX_BUFFER_LENGTH:78,BROWSER:(typeof window!=='undefined'),NODE:(typeof process==='object'),RHINO:(typeof java!=='undefined'&&typeof java.lang!=='undefined'),WINDOZE:(typeof window!=='undefined'||typeof WScript!=='undefined'),WSH:(typeof WScript!=='undefined'),coloring:function(){return!(this.BROWSER&&!window.runtime)&&!this.WINDOZE},__buffer__:'',__format__:'',ESCAPE_CODES:{reset:0,bold:1,normal:22,underline:4,noline:24,blink:5,noblink:25,black:30,bgblack:40,red:31,bgred:41,green:32,bggreen:42,yellow:33,bgyellow:43,blue:34,bgblue:44,magenta:35,bgmagenta:45,cyan:36,bgcyan:46,white:37,bgwhite:47,nocolor:39,bgnocolor:49},escape:function(a){return this.ANSI_CSI+a},repeat:function(a,b){var c='';while(b--)c+=a;return c},pad:function(a,b){a=(a===undefined?'':a).toString();return a+this.repeat(' ',b-a.length)},flushFormat:function(){var a=this.__format__;this.__format__='';return a},output:function(a,b){while(a.length>0){var c=this.__buffer__.length,e=this.BROWSER?1000:this.MAX_BUFFER_LENGTH,g=(c>0&&this.coloring()),d=g?this.escape('1F')+this.escape((c+1)+'G'):'',f=a.substr(0,e-c);this.__buffer__+=f;if(this.coloring())this.writeToStdout(d+this.flushFormat()+f);else if(this.__buffer__.length===e)this.writeToStdout(this.__buffer__);if(this.__buffer__.length===e)this.__buffer__='';a=a.substr(e-c)}if(!b){if(a===''&&!this.__buffer__)this.writeToStdout(this.flushFormat()+'');if(!this.coloring()&&this.__buffer__)this.writeToStdout(this.__buffer__);this.__buffer__=''}},writeToStdout:function(a){if(this.BROWSER&&window.runtime)return window.runtime.trace(a);if(this.NODE)return console.warn(a);if(this.RHINO)return java.lang.System.out.println(a);if(this.WSH)return WScript.Echo(a);if(typeof console!=='undefined')return console.log(a);if(typeof alert==='function')return alert(a);if(typeof print==='function')return print(a)}},consoleFormat:function(){if(!JS.Console.coloring())return;this.reset();var a=arguments.length;while(a--)this[arguments[a]]()},puts:function(a){a=(a===undefined?'':a).toString();var b=JS.Console;if(b.NODE||b.RHINO){b.writeToStdout(b.flushFormat()+a);b.__print__=false}else{b.output(a,false)}},print:function(a){a=(a===undefined?'':a).toString();var b=JS.Console;if(b.NODE){require('sys').print(b.flushFormat()+a);b.__print__=true}else if(b.RHINO){java.lang.System.out.print(b.flushFormat()+a);b.__print__=true}else{b.output(a,true)}},printTable:function(d,f){var h=[],d=[['Method','Calls']].concat(d),l=JS.Console,j=d.length,i,m;while(j--){i=d[j].length;while(i--){h[i]=h[i]||0;m=(d[j][i]===undefined?'':d[j][i]).toString();h[i]=Math.max(m.length,h[i])}}var k='+',i=h.length;while(i--)k='+'+l.repeat('-',h[i]+2)+k;k='  '+k;this.reset();this.puts();this.puts(k);var n=function(a,b){var c=d[a];this.reset();this.print('  ');for(var e=0,g=c.length;e<g;e++){this.reset();this.print('|');this.consoleFormat.apply(this,b);this.print(' '+l.pad(c[e],h[e])+' ')}this.reset();this.puts('|')};n.call(this,0,['bold']);this.reset();this.puts(k);for(var j=1,o=d.length;j<o;j++){var p=f?f(d[j],j):[];n.call(this,j,p)}this.reset();this.puts(k)}});(function(){var c=JS.Console;for(var e in c.ESCAPE_CODES)(function(b){c.define(b,function(){if(!JS.Console.coloring())return;var a=c.ESCAPE_CODES[b];c.__format__+=c.escape(a+'m')})})(e);c.extend(c)})();